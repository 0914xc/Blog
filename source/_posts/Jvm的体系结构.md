---
title: Jvm的体系结构
date: 2022-05-07 20:53:02
categories: Java
---

JVM的整体架构可以划分为两部分来看待：**加载**和**执行**。

1. 类加载器负责字节码文件的加载。
1. 执行引擎负责字节码指令执行。

![](https://cdn.nlark.com/yuque/0/2022/jpeg/1008459/1645414818516-14b09948-62b1-43ad-a0db-d574c060814e.jpeg)

### 运行时数据区

JVM在运行时，会从操作系统内存中划分一块区域作为自己的内存，即运行时数据区。在JVM内部又会对这部分内存区域进行详细的划分，大体划分规则如下：

1. 线程共享数据区：方法去、堆
1. 线程私有数据区：虚拟机栈、本地方法栈、程序计数器

> JVM允许一个应用并发执行多个线程。
>
> HotSpot VM中的Java线程与原生操作系统线程有直接映射关系：当线程本地存储、缓冲区分配、同步对象、栈、程序计数器等准备好以后，就会创建一个原生操作系统线程。操作系统负责调度所有原生线程，并把它们分配到任何可用的CPU上。当原生线程初始化完毕，就会调用Java线程的run()方法。当线程结束时，会释放原生线程和Java线程。


**程序计数器 Program Counter Register**
程序计数器是当前线程所执行的字节码的行号指示器，每条线程都要有一个独立的程序计数器。

**虚拟机栈 JVM Stacks**
描述Java方法执行的内存模型，每个方法从调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中入栈到出战的过程。

栈帧是用来存储数据和部分过程结果的数据结构，同时也被用来处理动态连接、方法返回值和异常分派。栈帧随着方法调用而创建，随着方法结束而销毁。

![](https://cdn.nlark.com/yuque/0/2022/jpeg/1008459/1645612981370-02eeeadb-39c1-41f7-981d-a0b3634a1cc8.jpeg)

**本地方法栈 Native Method Stack**
描述本地方法执行的内存模式。但在HotSpot VM中，直接就把本地方法栈和虚拟机栈合二为一。

**堆 Java Heap**
创建的对象和数组都保存在Java堆内存中。

**方法区 Method Area**
用于存储被JVM加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。但在HotSpot VM使用堆的永久代来实现方法区。

